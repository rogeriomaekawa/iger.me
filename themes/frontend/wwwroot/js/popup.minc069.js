(function($){var shadowId="popup-shadow",zIndex=1e3;$.fn.popup=function(options){options=options||{};var $p=$(this),offX=options.x||0,offY=options.y||0,shadow=options.shadow||false,shadow_color=options.shadow_color||"000000",shadow_opacity=options.shadow_opacity||.75,shadow_close=options.shadow_close||false,click_to_close=options.click_to_close||false,modal=options.modal||$p.data("popup-modal")||false,text=options.text||null;$.popupZ=$.popupZ?++$.popupZ:zIndex+1;$.popupCount=$.popupCount?++$.popupCount:1;if(modal){$("*[data-popup-close]",$p).hide()}else{$("*[data-popup-close]",$p).show();if(click_to_close){$p.attr("data-popup-close",$p.selector)}}$p.css({position:"absolute",display:"block",visibility:"hidden",zIndex:$.popupZ});var left=$(document).scrollLeft()+offX;var top=$(document).scrollTop()+offY;if($(window).width()>$p.outerWidth()){left+=$(window).width()/2-$p.outerWidth()/2}if($(window).height()>$p.outerHeight()){top+=$(window).height()/2-$p.outerHeight()/2}$p.css({left:left+"px",top:top+"px",zIndex:$.popupZ,visibility:"visible"});if(shadow){var $shadow=$("#"+shadowId);if($shadow.length==0){$shadow=$('<div id="'+shadowId+'" data-popup-close></div>').css({display:"none",position:"fixed",left:0,right:0,top:0,bottom:0,width:"100%",height:"100%",margin:0,padding:0});$shadow.appendTo("body")}if(modal){$shadow.removeAttr("data-popup-close")}else if(shadow_close){$shadow.attr("data-popup-close",$p.selector).data("popup-close",$p.selector)}$shadow.css({background:"#"+shadow_color,opacity:shadow_opacity,zIndex:$.popupZ-1}).show()}if(text){$p.find(".text").html(text)}return this};$.fn.popupClose=function(options){var $popup=$(this),$shadow=$("#"+shadowId);$.popupZ=$.popupZ?--$.popupZ:zIndex;$.popupCount=$.popupCount?--$.popupCount:0;$popup.hide();if($.popupCount===0){$shadow.hide()}else{$shadow.css({zIndex:$.popupZ-1})}if(options&&typeof options.on_close=="function"){options.on_close($popup,$shadow,options)}return this}})(jQuery);